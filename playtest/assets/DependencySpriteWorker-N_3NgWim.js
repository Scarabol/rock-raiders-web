(function(){"use strict";class w{constructor(t){this.worker=t,t.addEventListener("message",r=>this.onMessageFromFrontend(r?.data))}onMessageFromFrontend=()=>{throw new Error("Not implemented")};sendResponse(t,r){this.worker.postMessage(t,r)}}class A{constructor(t){this.worker=t,t.onMessageFromFrontend=r=>{try{r.request?this.onMessageFromFrontend(r.workerRequestHash,r.request):console.warn("Worker received message without request from frontend")}catch(a){console.error(a)}}}sendResponse(t,r,a){this.worker.sendResponse({workerRequestHash:t,response:r},a)}}var L=(e=>(e.NONE="",e.PILOT="Pilot",e.TOOLSTATION="Toolstation",e.TELEPORT_PAD="TeleportPad",e.DOCKS="Docks",e.POWER_STATION="PowerStation",e.BARRACKS="Barracks",e.UPGRADE="Upgrade",e.GEODOME="Geo-Dome",e.ORE_REFINERY="OreRefinery",e.GUNSTATION="Gunstation",e.TELEPORT_BIG="TeleportBIG",e.POWER_PATH="Path",e.BAT="Bat",e.SMALL_SPIDER="SmallSpider",e.SLUG="Slug",e.ROCK_MONSTER="RockMonster",e.ICE_MONSTER="IceMonster",e.LAVA_MONSTER="LavaMonster",e.DYNAMITE="Dynamite",e.ELECTRIC_FENCE="ElectricFence",e.CRYSTAL="PowerCrystal",e.ORE="Ore",e.BRICK="ProcessedOre",e.BARRIER="Barrier",e.DEPLETED_CRYSTAL="DepletedCrystal",e.HOVERBOARD="Hoverboard",e.SMALL_DIGGER="SmallDigger",e.SMALL_TRUCK="SmallTruck",e.SMALL_CAT="SmallCat",e.SMALL_MLP="SmallMlp",e.SMALL_HELI="SmallHeli",e.BULLDOZER="Bulldozer",e.WALKER_DIGGER="WalkerDigger",e.LARGE_MLP="LargeMlp",e.LARGE_DIGGER="LargeDigger",e.LARGE_CAT="LargeCat",e.LARGE_HELI="LargeHeli",e.TV_CAMERA="TvCamera",e.LASER_SHOT="LaserShot",e.FREEZER_SHOT="FreezerShot",e.PUSHER_SHOT="PusherShot",e.BIRD_SCARER="BirdScarer",e.BOULDER="Boulder",e.BOULDER_ICE="BoulderIce",e))(L||{});function C(e,t){if(!e)throw new Error("No canvas given");const r=e.getContext("2d",t);if(!r)throw new Error("Could not get context");return r}function M(e,t){const r=document.createElement("canvas");return r.width=e,r.height=t,r}function S(e,t){if(e<1||t<1)return console.error(`Can't create context with size ${e} x ${t}`),O(64,64);let r;return typeof document<"u"?r=M(e,t):r=new OffscreenCanvas(e,t),C(r)}function O(e,t){const r=S(e,t);for(let a=0;a<t;a+=16)for(let o=0;o<e;o+=16)o/16%2===a/16%2?r.fillStyle="rgb(0,255,255)":r.fillStyle="rgb(255,0,255)",r.fillRect(o,a,16,16);return r}function _(e,t,r,a,o,s,i=255){const n=(r*e.width+t)*4;e.data[n]=a,e.data[n+1]=o,e.data[n+2]=s,e.data[n+3]=i}function D(e,t,r){const a=(r*e.width+t)*4;return{r:e.data[a],g:e.data[a+1],b:e.data[a+2],a:e.data[a+3]}}function R(e){const t=S(e.width,e.height);return t.putImageData(e,0,0),t.canvas}class v{constructor(t){this.data=t}createTextImageData(t,r,a=!0){if(!t)return;t=t.replace(/_/g," ");const o=this.determineRows(t,r),s=Math.max(1,...o.map(n=>n.width)),i=new ImageData(s,this.data.charHeight*(o.length||1));return o.forEach((n,d)=>{const u=a?Math.round((s-n.width)/2):0,m=d*this.data.charHeight;let h=0;for(let c=0;c<n.text.length;c++){const l=this.data.charCodeMap.get(n.text.charCodeAt(c));if(l){for(let g=h;g<h+l.width;g++)for(let f=0;f<l.height;f++){const I=D(l,g-h,f);_(i,u+g,m+f,I.r,I.g,I.b,I.a)}h+=l.width}}}),i}createTextImage(t,r,a=!0){if(!t)return;const o=this.createTextImageData(t,r,a);if(!o)return;const s=S(o.width,o.height);return s.putImageData(o,0,0),s.canvas}determineRows(t,r){const a=[];let o="",s=0;return t.replaceAll("	","    ").split(" ").forEach(i=>{let n=0;for(let d=0;d<i.length;d++){const u=i.charCodeAt(d),m=this.data.charCodeMap.get(u);if(m)n+=m.width;else{const h=i.charAt(d);u!==13&&console.error(`Ignoring letter '${h}' (${u}) of word "${t}" not found in charset of size ${this.data.charCodeMap.size}!`)}}s>0?!r||s+this.data.spaceWidth+n<r?(o+=` ${i}`,s+=this.data.spaceWidth+n):(a.push({text:o,width:s}),o=i,s=n):(o+=i,s+=n)}),s>0&&a.push({text:o,width:s}),a}}class p extends A{interfaceImages=new Map;interfaceBuildImages=new Map;upgradeNames;tooltipFont;plusSignImg;equalsSignImg;onMessageFromFrontend(t,r){switch(r.type){case 1:this.upgradeNames=r.upgradeNames,this.tooltipFont=new v(r.tooltipFontData),this.plusSignImg=R(r.plusSignImgData),this.equalsSignImg=R(r.equalSignImgData),r.interfaceImageData.forEach((c,l)=>this.interfaceImages.set(l.toLowerCase(),[R(c[0]),R(c[1])])),r.interfaceBuildImageData.forEach((c,l)=>this.interfaceBuildImages.set(l.toLowerCase(),[R(c[0]),R(c[1])])),this.sendResponse(t,{});break;case 2:const a=this.upgradeNames,o=this.tooltipFont,s=this.plusSignImg,i=this.equalsSignImg;if(!a||!o||!s||!i){console.error("Dependency sprite worker not yet setup",a,o,s,i),this.sendResponse(t,{});return}let n=0,d=0;const u=r.dependencies.map(c=>{let l;if(c.entityType===L.PILOT?l=this.interfaceImages.get("Interface_MenuItem_TeleportMan".toLowerCase()):l=this.interfaceBuildImages.get(c.itemKey.toLowerCase()),!Array.isArray(l)||l.length!==2)throw new Error(`Unexpected dependency images array (${l})`);const g=c.isOk?l[0]:l[1];return n+=g.width,d=Math.max(d,g.height),{img:g,level:c.minLevel}});n+=s.width*(u.length-1),n+=i.width*2;const m=S(n,d);let h=0;u.forEach((c,l)=>{if(m.drawImage(c.img,h,(d-c.img.height)/2),c.level){const f=a[c.level-1];if(f){const I=o.createTextImage(f);I&&m.drawImage(I,h+3,(d-c.img.height)/2+3)}}h+=c.img.width;const g=l===u.length-1?i:s;m.drawImage(g,h,(d-g.height)/2),h+=g.width}),this.sendResponse(t,{dependencyImage:m.getImageData(0,0,m.canvas.width,m.canvas.height)});break}}}const B=self;new p(new w(B))})();
//# sourceMappingURL=DependencySpriteWorker-N_3NgWim.js.map
