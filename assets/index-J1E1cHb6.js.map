{"version":3,"mappings":"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","names":["items","item","element","index","lastIndex","predicate","callback","counter","e","filter","left","right","a","value","key","insertCallback","updateCallback","other","HTML_GAME_CONTAINER","HTML_GAME_CANVAS_CONTAINER","getPath","url","strUrl","lastInd","getFilename","iGet","obj","keys","keyName","clearTimeoutSafe","timeout","clearIntervalSafe","interval","cancelAnimationFrameSafe","handle","yieldToMainThread","resolve","isNum","DebugHelper","context","message","optionalParams","color","msg","p","x","y","w","h","bottom","c","barHeight","now","fpsDeltaMs","useDeltaMs","prev","val","app"],"ignoreList":[],"sources":["../../src/core/Array.ts","../../src/core/Map.ts","../../src/core/String.ts","../../src/core/index.ts","../../src/core/Util.ts","../../src/screen/DebugHelper.ts","../../src/index.ts"],"sourcesContent":["export {}\n\ndeclare global {\n    interface Array<T> {\n        add(...element: T[]): void\n\n        remove(element: T): void\n\n        removeLast(element: T): void\n\n        removeAll(predicate: (e: T) => boolean): void\n\n        last(): T | undefined\n\n        count(callback: (element: T) => boolean): number\n\n        partition(filter: (element: T) => boolean): [T[], T[]]\n    }\n\n    // noinspection JSUnusedGlobalSymbols\n    interface ArrayConstructor {\n        ensure<T>(value: T | T[]): T[]\n    }\n}\n\nArray.prototype.add = function <T>(...items: T[]): void {\n    items?.forEach((item) => {\n        const index = this.indexOf(item)\n        if (index === -1) this.push(item)\n    })\n}\n\nArray.prototype.remove = function <T>(element: T): void {\n    const index = this.indexOf(element)\n    if (index !== -1) this.splice(index, 1)\n}\n\nArray.prototype.removeLast = function <T>(element: T): void {\n    const lastIndex = this.indexOf(element)\n    if (lastIndex !== -1) this.splice(lastIndex, 1)\n}\n\nArray.prototype.removeAll = function <T>(predicate: (e: T) => boolean): void {\n    let index = -1\n    while ((index = this.findIndex(predicate)) >= 0) {\n        this.splice(index, 1)\n    }\n}\n\nArray.prototype.last = function <T>(): T | undefined {\n    return this[this.length > 1 ? this.length - 1 : 0]\n}\n\nArray.prototype.count = function <T>(callback: (element: T) => boolean): number {\n    let counter = 0\n    this.forEach((e: T) => callback(e) && counter++)\n    return counter\n}\n\nArray.prototype.partition = function <T>(filter: (element: T) => boolean): [T[], T[]] {\n    const left: T[] = [], right: T[] = []\n    this.forEach((a: T) => filter(a) ? left.push(a) : right.push(a))\n    return [left, right]\n}\n\nArray.ensure = function <T>(value: T | T[]): T[] {\n    return (!value) ? [] : Array.isArray(value) ? value : [value]\n}\n","declare global {\n    interface Map<K, V> {\n        getOrUpdate(key: K, updateCallback: () => V): V\n\n        upsert(key: K, updateCallback: (prevVal?: V) => V): V\n    }\n}\n\n// XXX Might be replaced with Map.prototype.emplace one day, see https://github.com/tc39/proposal-upsert\nMap.prototype.getOrUpdate = function <K, V>(key: K, insertCallback: () => V): V {\n    let value = this.get(key)\n    if (value === undefined) {\n        value = insertCallback()\n        this.set(key, value)\n    }\n    return value\n}\n\n// XXX Might be replaced with Map.prototype.emplace one day, see https://github.com/tc39/proposal-upsert\nMap.prototype.upsert = function <K, V>(key: K, updateCallback: (prevVal?: V) => V): V {\n    const value = updateCallback(this.get(key)) // if used with Map.prototype.has this becomes incompatible with MapWithDefault\n    this.set(key, value)\n    return value\n}\n\nexport {}\n","declare global {\n    interface String {\n        equalsIgnoreCase(other?: string): boolean\n    }\n}\n\nString.prototype.equalsIgnoreCase = function (other?: string): boolean {\n    return this.toLowerCase() === other?.toLowerCase()\n}\n\nexport {}\n","export * from './Array'\nexport * from './Map'\nexport * from './String'\n\nexport const HTML_GAME_CONTAINER = document.getElementById('game-container')!\nexport const HTML_GAME_CANVAS_CONTAINER = document.getElementById('game-canvas-container')!\n","export function getPath(url: string): string {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.slice(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    strUrl = strUrl.slice(0, lastInd + 1)\n    if (strUrl.startsWith('/')) strUrl = strUrl.slice(1)\n    return strUrl\n}\n\nexport function getFilename(url: string): string {\n    if (!url) return url\n    let strUrl = url.toString().replace(/\\\\/g, '/')\n    if (strUrl.startsWith('/')) strUrl = strUrl.slice(1)\n    const lastInd = strUrl.lastIndexOf('/')\n    return strUrl.slice(lastInd + 1)\n}\n\nexport function iGet(obj: any, ...keys: string[]): any {\n    keys.forEach((keyName) => {\n        obj = Object.keys(obj)\n            .filter((key) => key.toLowerCase() === keyName.toLowerCase())\n            .map((key) => obj[key])\n        obj = obj ? obj[0] : obj\n    })\n    return obj\n}\n\nexport function clearTimeoutSafe(timeout?: NodeJS.Timeout): undefined {\n    if (timeout) clearTimeout(timeout)\n    return undefined\n}\n\nexport function clearIntervalSafe(interval?: NodeJS.Timeout): undefined {\n    if (interval) clearInterval(interval)\n    return undefined\n}\n\nexport function cancelAnimationFrameSafe(handle?: number): undefined {\n    if (handle) cancelAnimationFrame(handle)\n    return undefined\n}\n\nexport function yieldToMainThread(): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve))\n}\n\nexport function isNum(value: any): value is number {\n    return value !== undefined && value !== null && !isNaN(value)\n}\n","import { SpriteContext } from '../core/Sprite'\nimport { cancelAnimationFrameSafe, clearIntervalSafe } from '../core/Util'\nimport { HTML_GAME_CONTAINER } from '../core'\n\nexport class DebugHelper {\n    static readonly element: HTMLElement = HTML_GAME_CONTAINER.querySelector('div.game-debug-layer')!\n    static readonly messageContainer: HTMLElement = this.element.querySelector('div.game-debug-message-container')!\n    static readonly maxNumFpsValues = 150\n    static readonly nativeLog = console.log\n    static readonly nativeWarn = console.warn\n    static readonly nativeError = console.error\n\n    readonly fpsContext: SpriteContext\n    readonly fpsValues: number[] = []\n    readonly useValues: number[] = []\n    renderStartTimestampMs: number = 0\n    renderEndTimestampMs: number = 0\n    fpsIndex: number = 0\n    fps: number = 0\n    usage: number = 0\n    renderInterval?: NodeJS.Timeout\n    animationFrame?: number\n\n    constructor() {\n        const context = DebugHelper.element.querySelector<HTMLCanvasElement>('canvas.game-debug-fps-canvas')?.getContext('2d')\n        if (!context) throw new Error('Could not get context for fps rendering')\n        this.fpsContext = context\n    }\n\n    static intersectConsoleLogging() {\n        console.log = (message?: any, ...optionalParams: any[]): void => {\n            this.nativeLog(message, ...optionalParams)\n            this.addDebugMessage(message, optionalParams, '#ffffff')\n        }\n        console.warn = (message?: any, ...optionalParams: any[]): void => {\n            this.nativeWarn(message, ...optionalParams)\n            this.addDebugMessage(message, optionalParams, '#ffff00')\n        }\n        console.error = (message?: any, ...optionalParams: any[]) => {\n            this.nativeError(message, ...optionalParams)\n            this.addDebugMessage(message, optionalParams, '#ff0000')\n        }\n    }\n\n    static addDebugMessage(message: any, optionalParams: any[], color: string) {\n        try {\n            if (DebugHelper.messageContainer.children.length > 100 && DebugHelper.messageContainer.lastChild) DebugHelper.messageContainer.removeChild(DebugHelper.messageContainer.lastChild)\n            const msg = DebugHelper.messageContainer.insertBefore(document.createElement('div'), DebugHelper.messageContainer.firstChild)\n            msg.innerText = message\n            optionalParams.forEach((p) => msg.innerText += `\\n${JSON.stringify(p)}`)\n            msg.style.padding = '0.1em'\n            msg.style.color = color\n            msg.style.userSelect = 'none'\n        } catch (e) {\n            this.nativeError(e)\n        }\n    }\n\n    static toggleDisplay(): void {\n        if (!this.element) return\n        this.element.style.display = this.element.style.display === 'none' ? 'block' : 'none'\n    }\n\n    show() {\n        this.renderInterval = clearIntervalSafe(this.renderInterval)\n        this.renderInterval = setInterval(() => {\n            this.animationFrame = cancelAnimationFrameSafe(this.animationFrame)\n            this.animationFrame = requestAnimationFrame(() => {\n                this.fpsContext.clearRect(0, 0, 300, 150)\n                this.drawFpsDiagram(0, 0, 300, 150)\n            })\n        }, 1000 / 60)\n    }\n\n    hide() {\n        this.renderInterval = clearIntervalSafe(this.renderInterval)\n        this.fpsContext.clearRect(0, 0, 300, 150)\n    }\n\n    drawFpsDiagram(x: number, y: number, w: number, h: number) {\n        this.fpsContext.fillStyle = '#069'\n        this.fpsContext.fillRect(x, y, w, h)\n        this.fpsContext.fillStyle = '#0ff'\n        this.fpsContext.font = `bold 32px Helvetica,Arial,sans-serif`\n        this.fpsContext.textBaseline = 'top'\n        this.fpsContext.fillText(`FPS: ${this.fps} (${this.usage}%)`, x + 1, y + 1)\n        const right = x + w - 1\n        const bottom = y + h\n        for (let c = 0; c < this.fpsValues.length; c++) {\n            const index = (DebugHelper.maxNumFpsValues + this.fpsIndex - c) % DebugHelper.maxNumFpsValues\n            const barHeight = Math.round(Math.min(150, this.fpsValues[index] ?? 0) / 150 * 120)\n            this.fpsContext.fillRect(right - c * 2, bottom - barHeight, 2, barHeight)\n        }\n    }\n\n    onRenderStart() {\n        this.renderStartTimestampMs = performance.now()\n    }\n\n    onRenderDone() {\n        const now = performance.now()\n        const fpsDeltaMs = now - this.renderEndTimestampMs\n        const useDeltaMs = now - this.renderStartTimestampMs\n        this.renderEndTimestampMs = now\n        this.fpsValues[this.fpsIndex] = fpsDeltaMs > 0 ? Math.round(1000 / fpsDeltaMs) : 0\n        this.useValues[this.fpsIndex] = useDeltaMs > 0 ? Math.round(1000 / useDeltaMs) : 0\n        this.fpsIndex = (this.fpsIndex + 1) % DebugHelper.maxNumFpsValues\n        this.fps = Math.round(this.fpsValues.reduce((prev, val) => prev + val, 0) / this.fpsValues.length)\n        this.usage = Math.round(useDeltaMs / fpsDeltaMs * 100)\n    }\n}\n","import './core'\nimport { DEV_MODE } from './params'\nimport { DebugHelper } from './screen/DebugHelper'\n\nif (DEV_MODE) console.warn('DEV MODE ACTIVE')\nelse DebugHelper.intersectConsoleLogging()\nconsole.log(`Rock Raiders Web v${APP_VERSION}`)\n\nimport('./app').then((app) => app.start())\n"],"file":"index-J1E1cHb6.js"}